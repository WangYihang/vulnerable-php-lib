<?php

/**
 * CommandInjectionVulnerability - Command Injection
 * 
 * 命令注入漏洞演示，展示不同安全等级的ping命令参数校验
 * 
 * Category: VulnerabilityCategory.INJECTION
 * Severity: SeverityLevel.CRITICAL
 * 
 * WARNING: This code contains intentional security vulnerabilities for educational purposes only.
 * DO NOT use this code in production environments.
 */

namespace Wangyihang\VulnerablePhpLib;

/**
 * Command Injection
 * 
 * 命令注入漏洞演示，展示不同安全等级的ping命令参数校验
 */
class CommandInjectionVulnerability
{
    /**
     * 不安全的ping命令 - 无任何参数校验
     * 
     * Severity: SeverityLevel.CRITICAL
     * 
     * @param string $host 目标主机
     * @return string
     */
    public function unsafePing(string $host): string
    {
        // 危险：直接拼接命令，无任何校验
        $command = "ping -c 4 " . $host;
        return shell_exec($command);
    }
    /**
     * 弱校验ping命令 - 仅检查空格
     * 
     * Severity: SeverityLevel.HIGH
     * 
     * @param string $host 目标主机
     * @return string
     */
    public function weakPing(string $host): string
    {
        // 危险：仅检查空格，仍可注入
        if (strpos($host, ' ') !== false) {
            return 'Invalid hostname';
        }
        $command = "ping -c 4 " . $host;
        return shell_exec($command);
    }
    /**
     * 中等校验ping命令 - 检查特殊字符
     * 
     * Severity: SeverityLevel.MEDIUM
     * 
     * @param string $host 目标主机
     * @return string
     */
    public function mediumPing(string $host): string
    {
        // 危险：检查部分特殊字符，但仍有绕过方法
        $dangerous_chars = [';', '|', '&', '`', '$', '(', ')', '>', '<'];
        foreach ($dangerous_chars as $char) {
            if (strpos($host, $char) !== false) {
                return 'Invalid hostname';
            }
        }
        $command = "ping -c 4 " . $host;
        return shell_exec($command);
    }
    /**
     * 强校验ping命令 - 白名单验证
     * 
     * Severity: SeverityLevel.LOW
     * 
     * @param string $host 目标主机
     * @return string
     */
    public function strongPing(string $host): string
    {
        // 相对安全：使用白名单验证
        $allowed_hosts = ['localhost', '127.0.0.1', 'google.com', 'github.com'];
        if (!in_array($host, $allowed_hosts)) {
            return 'Host not allowed';
        }
        $command = "ping -c 4 " . escapeshellarg($host);
        return shell_exec($command);
    }
} 